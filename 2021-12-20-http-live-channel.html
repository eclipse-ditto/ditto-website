<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="keywords" content="bloghttp,  ">
<title>  Sending live channel commands via HTTP to devices • Eclipse Ditto™</title>

<link rel="stylesheet" href="css/syntax.css">
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" crossorigin="anonymous">
<link rel="stylesheet" href="css/modern-business.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" crossorigin="anonymous">
<link rel="stylesheet" href="css/customstyles.css">
<link rel="stylesheet" href="css/boxshadowproperties.css">
<link rel="stylesheet" href="css/theme-ditto.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700|Source+Code+Pro:300,600|Titillium+Web:400,600,700">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js" crossorigin="anonymous"></script>
<script src="js/toc.js"></script>
<script src="js/customscripts.js"></script>

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "url": "https://www.eclipse.dev/ditto/",
  "logo": "https://www.eclipse.dev/ditto/images/ditto.svg"
}
</script>

<link rel="icon" type="image/png" href="images/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="images/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="images/favicon-96x96.png" sizes="96x96">

<link rel="alternate" type="application/rss+xml" title="Eclipse Ditto Blog" href="https://www.eclipse.dev/ditto/feed.xml">

<!-- Eclipse Foundation cookie consent: -->
<link rel="stylesheet" type="text/css" href="https://www.eclipse.org/eclipse.org-common/themes/solstice/public/stylesheets/vendor/cookieconsent/cookieconsent.min.css" />
<script src="https://www.eclipse.org/eclipse.org-common/themes/solstice/public/javascript/vendor/cookieconsent/default.min.js"></script>

    <script>
        $(document).ready(function() {
            $("#tg-sb-link").click(function() {
                $("#tg-sb-sidebar").toggle();
                $("#tg-sb-content").toggleClass('col-md-9');
                $("#tg-sb-content").toggleClass('col-md-12');
                $("#tg-sb-icon").toggleClass('fa-toggle-on');
                $("#tg-sb-icon").toggleClass('fa-toggle-off');
            });
        });
    </script>
</head>


<script>
    (function(w,d,s,l,i){
        w[l]=w[l]||[];
        w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});
        var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),
            dl=l!='dataLayer'?'&l='+l:'';
        j.async=true;
        j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
        f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-5WLCZXC');
</script>



<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-ditto-home" href="index.html">&nbsp;<img src="images/ditto_allwhite_symbolonly.svg" class="ditto-navbar-symbol" alt="Home"> <img src="images/ditto_allwhite_textonly.svg" class="ditto-navbar-symbol-text" alt="Eclipse Ditto™"></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- toggle sidebar button -->
                <!--<li><a id="tg-sb-link" href="#"><i id="tg-sb-icon" class="fa fa-toggle-on"></i> Nav</a></li>-->
                <!-- entries without drop-downs appear here -->




                
                
                
                <li><a href="blog.html">Blog</a></li>
                
                
                
                <li><a href="intro-overview.html">Documentation</a></li>
                
                
                
                <li><a href="http-api-doc.html">HTTP API</a></li>
                
                
                
                <li><a href="sandbox.html">Sandbox</a></li>
                
                
                
                  
                  <li><a href="https://github.com/eclipse-ditto/ditto" target="_blank">
                    <img src="images/GitHub-Mark-Light-32px.png" alt="Sources at GitHub">
                  </a></li>
                  
                
                
                
                  
                  <li><a href="https://github.com/eclipse-ditto/ditto-clients" target="_blank">
                    <img src="images/GitHub-Mark-Light-32px.png" alt="SDK sources at GitHub">SDKs
                  </a></li>
                  
                
                
                
                  
                  <li><a href="https://github.com/eclipse-ditto/ditto-examples" target="_blank">
                    <img src="images/GitHub-Mark-Light-32px.png" alt="Example sources at GitHub">examples
                  </a></li>
                  
                
                
                
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Links<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="https://projects.eclipse.org/projects/iot.ditto" target="_blank">Eclipse Ditto Project</a></li>
                        
                        
                        
                        <li><a href="https://www.eclipse.org/forums/index.php/f/364/" target="_blank">Forum</a></li>
                        
                        
                        
                        <li><a href="https://ci.eclipse.org/ditto/" target="_blank">Jenkins</a></li>
                        
                        
                        
                        <li><a href="https://dev.eclipse.org/mhonarc/lists/ditto-dev/" target="_blank">Mailing list archives</a></li>
                        
                        
                        
                        <li><a href="https://gitter.im/eclipse/ditto" target="_blank">Gitter.im chat</a></li>
                        
                        
                    </ul>
                </li>
                
                
                
                <!--comment out this block if you want to hide search-->
                <li>
                    <!--start search-->
                    <div id="search-demo-container">
                        <input type="text" id="search-input" placeholder="search...">
                        <ul id="results-container"></ul>
                    </div>
                    <script src="https://cdnjs.cloudflare.com/ajax/libs/simple-jekyll-search/0.0.9/jekyll-search.js" type="text/javascript"></script>
                    <script type="text/javascript">
                            SimpleJekyllSearch.init({
                                searchInput: document.getElementById('search-input'),
                                resultsContainer: document.getElementById('results-container'),
                                dataSource: 'search.json',
                                searchResultTemplate: '<li><a href="{url}" title="Sending live channel commands via HTTP to devices">{title}</a></li>',
                                noResultsText: 'No results found.',
                                limit: 10,
                                fuzzy: true,
                    })
                    </script>
                    <!--end search-->
                </li>
            </ul>
        </div>
    </div>
    <!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container">
  <div id="main">
    <!-- Content Row -->
    <div class="row">
        
        

        <!-- Content Column -->
        <div class="col-md-12" id="tg-sb-content">
            <!-- Look the author details up from the site config. -->


<!-- Output author details if some exist. -->
<!-- Output author details if some exist. -->
<!---->
<!--<span>-->
    <!--&lt;!&ndash; Mugshot. &ndash;&gt;-->
    <!--<img src="https://www.gravatar.com/avatar/4125883975796a6f81e380b371438549?s=135" alt="A photo of Stefan Maute" />-->

<!--&lt;!&ndash; Personal Info. &ndash;&gt;-->
    <!--Written by <a href="https://github.com/stmaute" target="_blank">Stefan Maute</a>-->
<!--</span>-->
<!---->

<article class="post" itemscope itemtype="http://schema.org/BlogPosting">

    <header class="post-header">
        <h1 class="post-title" itemprop="name headline">Sending live channel commands via HTTP to devices</h1>
        <p class="post-meta">Published by <img src="https://www.gravatar.com/avatar/4125883975796a6f81e380b371438549?s=135" alt="A photo of Stefan Maute" style="width:50px;border-radius:50%;display:inline-block;margin-right:5px;" /><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name"><a href="https://github.com/stmaute" target="_blank">Stefan Maute</a> </span></span> on <time datetime="2021-12-20T00:00:00+00:00" itemprop="datePublished">Dec 20, 2021</time> - Tags:
            
            
            
            <a href="tag_blog.html">blog</a>, 
            
            
            
            <a href="tag_http.html">http</a>
            
            
            

        </p>


    </header>

    <div class="post-content" itemprop="articleBody">

        

        
        
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2,h3,h4' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 10);
  return false
})
  
});
</script>

<div id="toc"></div>

        

        <p>The upcoming release of Eclipse Ditto <strong>version 2.3.0</strong> will support sending commands via the HTTP API 
directly to devices using the <a href="protocol-twinlive.html#live">live channel</a> by just adding the <code class="highlighter-rouge">channel=live</code> 
query parameter to the same HTTP API request which would target the <a href="protocol-twinlive.html#twin">twin</a>.</p>

<h2 id="http-live-channel">HTTP Live channel</h2>

<p>Ditto supports sending all kind of <a href="protocol-specification-things.html#commands">Thing commands</a> via
the <code class="highlighter-rouge">live</code> channel directly to devices.
When sending a <code class="highlighter-rouge">live</code> command to  a device, the device is responsible for sending a correlated and correct response 
in <a href="protocol-overview.html">Ditto Protocol</a>.</p>

<p>Ditto supports two types of <code class="highlighter-rouge">channel</code>s for communication.</p>

<ul>
  <li><a href="protocol-twinlive.html#twin">twin</a>: The default value of the channel parameter is <code class="highlighter-rouge">twin</code> 
to communicate with the persisted <strong>twin</strong> representation.</li>
  <li><a href="protocol-twinlive.html#live">live</a>: The <code class="highlighter-rouge">channel</code> parameter can be changed to <code class="highlighter-rouge">live</code> 
to communicate with the real device.</li>
</ul>

<div class="alert alert-info" role="alert"><i class="fa fa-info-circle"></i> <b>Note:</b> In order to use the live channel, the device receiving live commands must be able to understand
  and answer in <a href="protocol-specification.html">Ditto Protocol messages</a> with the
<a href="protocol-specification-topic.html#live-channel">topic’s channel being <code class="highlighter-rouge">live</code></a>.</div>

<p>When using the <code class="highlighter-rouge">twin</code> channel, the command is routed to the Ditto backend and handled by the <strong>twin</strong> persistence.
Before using the <code class="highlighter-rouge">live</code> channel, it is necessary to create the <strong>digital twin</strong> of the device in the 
Ditto backend.</p>

<p>If the <code class="highlighter-rouge">live</code> channel is used, the command is directly routed to the device. In this case the device is 
responsible for answering the command and sending back a response. In case no response is sent back, the Ditto HTTP API 
is responding with <code class="highlighter-rouge">408 Request Timeout</code>.<br />
The default timeout for live commands is <code class="highlighter-rouge">10s</code> but it can be changed by setting the <code class="highlighter-rouge">timeout</code> parameter to the 
desired value.</p>

<p>Ditto ensures that the <code class="highlighter-rouge">correlation ID</code>, <code class="highlighter-rouge">entity ID</code>, <code class="highlighter-rouge">path</code> and <code class="highlighter-rouge">command response type</code> of the command response 
is the same as in the sending command. If this is not the case, Ditto is dropping the response and the caller of the 
HTTP request will get a <code class="highlighter-rouge">408 Request Timeout</code> with a message that the timeout was caused by an incompatible
command response from the device.</p>

<h3 id="permissions-for-live-commands">Permissions for live commands</h3>

<p>Sending live commands to devices is restricted by the policy of the thing.<br />
Thus Ditto ensures that only authorized parties with <code class="highlighter-rouge">WRITE</code> permission are able to send commands or messages.<br />
Ditto also filters responses from the device based on the policy. This ensures that the requester only gets the data
where he/she has <code class="highlighter-rouge">READ</code> permission on.</p>

<p>For retrieve commands, the <a href="basic-auth.html#authenticated-subjects">authenticated subject</a> needs to have 
(at least partial) <code class="highlighter-rouge">READ</code> permission at the resource which is requested.<br />
In case a <code class="highlighter-rouge">RetrieveThing</code> (via HTTP a <code class="highlighter-rouge">GET /api/2/things/&lt;thing-id&gt;</code>) command is sent to a real device and the 
requester only has partial <code class="highlighter-rouge">READ</code> permission on the thing, the response is filtered based on the policy 
and only the fields where <code class="highlighter-rouge">READ</code> permission is granted are returned.</p>

<h3 id="live-commands-via-http-api">Live commands via HTTP API</h3>

<p>When using the HTTP API the <code class="highlighter-rouge">channel</code> parameter can either be specified via HTTP Header or via HTTP query parameter.<br />
In the examples below both ways are possible to specify the channel parameter.</p>

<h4 id="live-command-with-http-header">Live command with HTTP Header</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-X</span> GET <span class="nt">-H</span> <span class="s1">'channel: live'</span> <span class="nt">-H</span> <span class="s1">'timeout: 30s'</span> /api/2/things/org.eclipse.ditto:coffeebrewer<span class="s1">'
</span></code></pre></div></div>

<h4 id="live-command-with-http-query-parameter">Live command with HTTP query parameter</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-X</span> GET /api/2/things/org.eclipse.ditto:coffeebrewer?channel<span class="o">=</span>live&amp;timeout<span class="o">=</span>30s<span class="s1">'
</span></code></pre></div></div>

<h2 id="example">Example</h2>

<p>The following section provides an example how to use the HTTP <code class="highlighter-rouge">live</code> channel together with the Ditto Java client.</p>

<p>For demonstration purpose, we assume that the thing with ID <code class="highlighter-rouge">org.eclipse.ditto:outdoor-sensor</code> already exists.</p>

<p>In this example we want to retrieve the live state of the device by sending a <code class="highlighter-rouge">RetrieveThing</code> command via
the <code class="highlighter-rouge">live</code> channel directly to the device.</p>

<h3 id="permissions-to-execute-the-example">Permissions to execute the example</h3>

<p>For this example, the <a href="basic-auth.html#authenticated-subjects">authenticated subject</a> has
<code class="highlighter-rouge">READ</code> and <code class="highlighter-rouge">WRITE</code> permissions on the complete thing resource to send the command and retrieve the full response.</p>

<h3 id="executing-the-example">Executing the example</h3>

<p>When sending a command over the <code class="highlighter-rouge">live</code> channel to a device, the device needs to take action and send back a response.<br />
The response from the device is routed back to the initial requester of the <code class="highlighter-rouge">live</code> command at the HTTP API.</p>

<p>In this example the <a href="client-sdk-java.html">Ditto Java Client</a> acts as device and sends back the response.<br />
The following snippet shows how to register for retrieve thing live commands and send back a <code class="highlighter-rouge">RetrieveThingResponse</code>.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">String</span> <span class="n">thingId</span> <span class="o">=</span> <span class="s">"org.eclipse.ditto:outdoor-sensor"</span><span class="o">;</span>
<span class="n">String</span> <span class="n">featureId</span> <span class="o">=</span> <span class="s">"environment-sensor"</span><span class="o">;</span>
<span class="n">Attributes</span> <span class="n">attributes</span> <span class="o">=</span> <span class="n">Attributes</span><span class="o">.</span><span class="na">newBuilder</span><span class="o">()</span>
  <span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">"location"</span><span class="o">,</span> <span class="s">"outdoor in the woods"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="n">Feature</span> <span class="n">feature</span> <span class="o">=</span> <span class="n">ThingsModelFactory</span><span class="o">.</span><span class="na">newFeatureBuilder</span><span class="o">()</span>
  <span class="o">.</span><span class="na">properties</span><span class="o">(</span><span class="n">ThingsModelFactory</span><span class="o">.</span><span class="na">newFeaturePropertiesBuilder</span><span class="o">()</span>
    <span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">"temperature"</span><span class="o">,</span> <span class="mf">9.2</span><span class="o">)</span>
    <span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">"humidity"</span><span class="o">,</span> <span class="mf">56.3</span><span class="o">)</span>
    <span class="o">.</span><span class="na">build</span><span class="o">())</span>
  <span class="o">.</span><span class="na">withId</span><span class="o">(</span><span class="n">featureId</span><span class="o">)</span>
  <span class="o">.</span><span class="na">build</span><span class="o">();</span>

<span class="n">Thing</span> <span class="n">thing</span> <span class="o">=</span> <span class="n">ThingsModelFactory</span><span class="o">.</span><span class="na">newThingBuilder</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="n">thingId</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setFeature</span><span class="o">(</span><span class="n">feature</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setAttributes</span><span class="o">(</span><span class="n">attributes</span><span class="o">)</span>
  <span class="o">.</span><span class="na">build</span><span class="o">();</span>

<span class="c1">// initialize the ditto-client and startConsumption() of live commands</span>
<span class="n">DittoClient</span> <span class="n">dittoClient</span> <span class="o">=</span> <span class="o">...</span> <span class="o">;</span>

<span class="n">dittoClient</span><span class="o">.</span><span class="na">live</span><span class="o">()</span>
  <span class="o">.</span><span class="na">forId</span><span class="o">(</span><span class="n">thingId</span><span class="o">)</span>
  <span class="o">.</span><span class="na">handleRetrieveThingCommandsFunction</span><span class="o">(</span><span class="n">retrieveThingLiveCommand</span> <span class="o">-&gt;</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">retrieveThingLiveCommand</span><span class="o">.</span><span class="na">answer</span><span class="o">()</span>
                  <span class="o">.</span><span class="na">withResponse</span><span class="o">(</span><span class="n">response</span> <span class="o">-&gt;</span> <span class="n">response</span><span class="o">.</span><span class="na">retrieved</span><span class="o">(</span><span class="n">thing</span><span class="o">));</span>
  <span class="o">});</span>
</code></pre></div></div>

<p>When the above shown code snippet is running and the following HTTP request is sent out:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-X</span> GET /api/2/things/org.eclipse.ditto:outdoor-sensor?channel<span class="o">=</span>live&amp;timeout<span class="o">=</span>15s
</code></pre></div></div>

<p>The received HTTP response payload should look like this:</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"thingId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"org.eclipse.ditto:outdoor-sensor"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"_namespace"</span><span class="p">:</span><span class="w"> </span><span class="s2">"org.eclipse.ditto"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"attributes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"location"</span><span class="p">:</span><span class="w"> </span><span class="s2">"outdoor in the woods"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"features"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"environment-sensor"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"temperature"</span><span class="p">:</span><span class="w"> </span><span class="mf">9.2</span><span class="p">,</span><span class="w">
        </span><span class="s2">"humidity"</span><span class="p">:</span><span class="w"> </span><span class="mf">56.3</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h2 id="feedback">Feedback?</h2>

<p>Please <a href="feedback.html">get in touch</a> if you have feedback or questions towards this new functionality.</p>

<p><br />
<br /></p>
<figure><img class="docimage" src="images/ditto.svg" alt="Ditto" style="max-width: 500px" /></figure>

<p>–<br /> 
The Eclipse Ditto team</p>

    </div>



</article>

<hr class="shaded"/>

<footer>
            <div class="row">
                <div class="col-lg-12 footer">
                    <div class="logo">
                        <a href="https://eclipse.org"><img src="images/eclipse_foundation_logo.svg" alt="Eclipse logo"/></a>
                    </div>
                    <p class="notice">
                        &copy;2023 Eclipse Ditto™.
                         Site last generated: Nov 9, 2023 <br />
                    </p>
                    <div class="quickLinks">
                        <a href="https://www.eclipse.org/legal/privacy.php" target="_blank">
                            &gt; Privacy Policy
                        </a>
                        <a href="https://www.eclipse.org/legal/termsofuse.php" target="_blank">
                            &gt; Terms of Use
                        </a>
                        <a href="https://www.eclipse.org/legal/copyright.php" target="_blank">
                            &gt; Copyright Agent
                        </a>
                        <a href="https://www.eclipse.org/legal" target="_blank">
                            &gt; Legal
                        </a>
                        <a href="https://www.eclipse.org/legal/epl-2.0/" target="_blank">
                            &gt; License
                        </a>
                        <a href="https://eclipse.org/security" target="_blank">
                            &gt; Report a Vulnerability
                        </a>
                    </div>
                </div>
            </div>
</footer>


        </div>
    <!-- /.row -->
</div>
<!-- /.container -->
</div>
<!-- /#main -->
    </div>

</body>
</html>
